<html lang="zh-TW"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸»è¦å…¥å£</title> <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f8ff;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden; /* Prevent horizontal scrollbar */
        }
        .container {
            background-color: #ffffff;
            padding: 20px 40px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
            width: 90%;
            max-width: 750px;
            position: relative;
            z-index: 1;
        }
        h1 {
            color: #ffffff; /* White text for the title */
            background-color: #28a745; /* Green background for the title */
            padding: 10px 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-family: 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
        }
        .admin-panel-container {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        #toggleAdminButton {
            padding: 8px 10px;
            font-size: 18px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            align-self: flex-start;
            flex-shrink: 0;
            font-family: 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            line-height: 1.2;
        }
        #toggleAdminButton:hover {
            background-color: #5a6268;
        }
        .admin-section {
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
            border: 1px solid #ced4da;
            text-align: left;
            flex-grow: 1;
        }
        .admin-section.hidden {
            display: none;
        }
        .action-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .action-row .menu-button {
            margin-right: 15px;
            flex-shrink: 0;
        }
        .inputs-container {
            display: flex;
            flex-grow: 1;
            flex-wrap: wrap;
            gap: 10px;
        }
        .inputs-container input[type="text"],
        .inputs-container input[type="url"],
        .inputs-container input[type="number"] {
            padding: 8px;
            margin-bottom: 5px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        #newButtonText { flex: 1 1 150px; min-width: 120px; }
        #newButtonUrl { flex: 1 1 200px; min-width: 150px; }
        #newButtonPosition { flex: 0 1 120px; min-width: 100px; }
        #removeButtonNumber { flex: 1 1 150px; min-width: 120px;}
        #newFileNameInput { flex: 1 1 250px; min-width: 200px; }
        .menu-button {
            padding: 8px 15px;
            text-decoration: none;
            color: white;
            background-color: #007bff;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-family: 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
            margin-bottom: 5px;
        }
        .menu-button.add { background-color: #28a745; }
        .menu-button.remove { background-color: #dc3545; }
        .menu-button.save-as { background-color: #17a2b8; }
        .menu-button:hover {
            color: white !important;
            background-color: #0056b3 !important;
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button-link:hover {
            color: #ffffff !important;
            background-color: #FF0000 !important;
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
         .button-link:active { transform: translateY(0); }
        .button-link-container {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            gap: 15px;
        }
        .button-link {
            padding: 12px 20px;
            text-decoration: none;
            color: #000000;
            background-color: #D2B48C;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-family: 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
            box-sizing: border-box;
            word-wrap: break-word;
            text-align: center;
            flex-grow: 1;
            flex-shrink: 1;
            min-width: 200px;
            max-width: 100%;
        }
        hr {
             border: 0;
             height: 1px;
             background: #ced4da;
             margin: 20px 0;
        }

        /* Original Car animation styles - START */
        .car-container-animation {
            position: fixed;
            top: 5px;
            right: -100px; 
            width: auto;
            height: auto;
            z-index: 9999;
            pointer-events: none;
            animation-name: driveAcrossScreenTop;
            animation-duration: 12s; 
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }

        .car-emoji-animation {
            font-size: 30px;
            display: inline-block;
        }

        @keyframes driveAcrossScreenTop {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(calc(-100vw - 100px));
            }
        }
        /* Original Car animation styles - END */

        /* Racing Cars Animation Styles - START */
        .racing-car-container {
            position: fixed;
            right: -120px; /* Start off-screen, adjust if emoji width differs significantly */
            width: auto;
            height: auto;
            z-index: 9998; /* Below the first car if y-levels were same, good for layering */
            pointer-events: none;
            animation-name: driveAcrossScreenTopRace; /* Shared keyframe for racing cars */
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            /* animation-duration is set by JavaScript for variability */
        }

        .racing-car-emoji {
            font-size: 30px; /* Consistent emoji size */
            display: inline-block;
        }

        #greenCarContainer {
            top: 45px; /* Lane for "green" team car (ğŸš™) */
        }

        #redCarContainer {
            top: 80px; /* Lane for "red" team car (ğŸï¸) */
        }
        
        /* Keyframe for racing cars */
        @keyframes driveAcrossScreenTopRace {
            0% {
                transform: translateX(0);
            }
            100% {
                /* Moves left across the entire viewport width plus its own width to disappear */
                transform: translateX(calc(-100vw - 120px)); /* 120px to ensure it's fully off-screen */
            }
        }
        /* Racing Cars Animation Styles - END */

    </style>
</head>
<body>
    <div class="car-container-animation">
      <span class="car-emoji-animation">ğŸš—</span>
    </div>
    <div class="racing-car-container" id="greenCarContainer" style="animation-duration: 7.67s;">
      <span class="racing-car-emoji" id="greenCarEmoji">ğŸš™</span> </div>
    <div class="racing-car-container" id="redCarContainer" style="animation-duration: 9.79s;">
      <span class="racing-car-emoji" id="redCarEmoji">ğŸï¸</span> </div>
    <div class="container">
        <h1 id="pageMainTitle">ä¸»è¦å…¥å£</h1>

        <div class="admin-panel-container">
            <button id="toggleAdminButton" title="éš±è—è¨­å®šå€å¡Š">âœ•</button>
            <div class="admin-section" id="adminSectionContent">
                <div class="action-row">
                    <button class="menu-button add" onclick="handleAddNewButton()">æ–°å¢æŒ‰éˆ•</button>
                    <div class="inputs-container">
                        <input type="text" id="newButtonText" placeholder="æŒ‰éˆ•æ–‡å­—">
                        <input type="url" id="newButtonUrl" placeholder="æŒ‰éˆ•ç¶²å€ (ä¾‹: page.html)">
                        <input type="number" id="newButtonPosition" placeholder="æ’å…¥ä½ç½®ç·¨è™Ÿ (å¯é¸)" min="1" max="20">
                    </div>
                </div>
                <hr>
                <div class="action-row">
                    <button class="menu-button remove" onclick="handleRemoveButton()">æ¸›å°‘æŒ‰éˆ•</button>
                    <div class="inputs-container">
                        <input type="number" id="removeButtonNumber" placeholder="è¦ç§»é™¤çš„æŒ‰éˆ•ç·¨è™Ÿ" min="1" max="19">
                    </div>
                </div>
                <hr>
                <div class="action-row">
                    <button class="menu-button save-as" id="handleSaveAsButton">ä¿®æ”¹æ¨™é¡Œä¸¦å¦å­˜</button>
                    <div class="inputs-container">
                        <input type="text" id="newFileNameInput" placeholder="æ–°æª”æ¡ˆæ¨™é¡Œ (é è¨­ç‚ºç›®å‰æ¨™é¡Œ)">
                    </div>
                </div>
            </div>
        </div>

        <div class="button-link-container" id="buttonLinkContainer"><a href="å®¢æˆ¶ç®¡ç†.html" class="button-link">1. å®¢æˆ¶ç®¡ç†</a><a href="https://share.evernote.com/note/c64a01a6-8956-430b-8cc8-88b6a364cd31" class="button-link">2. ä»²å¹³å—å±±äº‹æ¥­</a><a href="https://share.evernote.com/note/aed884ef-c0fe-9b16-e927-98fd7661c7ff" class="button-link">3. ä»²å¹³å…¨å®¶</a><a href="æä»²å¹³é›»è…¦æ¡Œé¢ç®¡ç†.html" class="button-link">4. é›»è…¦æ¡Œé¢ç®¡ç†</a><a href="ç¨‹å¼-æœˆæ›†ç­†è¨˜æœ¬å•å·/æœˆæ›†ç­†è¨˜æœ¬å•å·-çµ±è¨ˆè¡¨.html" class="button-link">5. 115å¹´æœˆæ›†ç­†è¨˜æœ¬çµ±è¨ˆè¡¨</a><a href="ç¨‹å¼-å»ºè­°æ›¸è¦åŠƒå•å·åŠå›å‡½/ä¿éšªè¦åŠƒå‰å•å·-çµ±è¨ˆè¡¨.html" class="button-link">6. ä¿éšªè¦åŠƒæƒ³æ³•å•å·</a><a href="å—å±±äººå£½æ¥­å‹™æ¨å»£.ç®¡ç†.è¡¨æ ¼ä¸‹è¼‰.html" class="button-link">7. å—å±±äººå£½æ¥­å‹™.ç®¡ç†.è¡¨æ ¼</a><a href="å—å±±ç”¢ç‰©æ¥­å‹™æ¨å»£.ç®¡ç†.è¡¨å–®ä¸‹è¼‰.html" class="button-link">8. å—å±±ç”¢ç‰©æ¥­å‹™.ç®¡ç†.è¡¨æ ¼</a><a href="ç¨‹å¼-å—å±±å•†å“å°è¦½/ä¿éšªå°è¦½ç³»çµ±_å®Œæ•´ç‰ˆ.html" class="button-link">9. å—å±±å•†å“å°è¦½</a><a href="https://chungpinglee.github.io/abc0480/%E4%BF%9D%E9%9A%AA%E5%B0%8E%E8%A6%BD%E7%B3%BB%E7%B5%B1_%E5%AE%8C%E6%95%B4%E7%89%88.html" class="button-link">10. å—å±±å•†å“å°è¦½-æ‰‹æ©Ÿç‰ˆ</a><a href="https://chungpinglee.github.io/abc0480/TED35%E8%88%87TED%E6%AF%94%E8%BC%83.html" class="button-link">11. TED35èˆ‡20TEDæ¯”è¼ƒ</a><a href="https://chungpinglee.github.io/abc0480/1131122%E6%9D%8E%E4%BB%B2%E5%B9%B3%E8%BB%8A%E9%9A%AA%E5%85%A7%E5%AE%B9%E8%BC%94%E5%8A%A9%E8%AA%AA%E6%98%8E.html" class="button-link">12. è»Šéšªå ±åƒ¹è¼”åŠ©èªªæ˜</a><a href="https://chungpinglee.github.io/abc0480/%E8%B2%A1%E7%A8%85%E9%80%9A-%E6%94%B9%E7%89%8844.html" class="button-link">13. æˆ¿åœ°åˆä¸€ç¨…è©¦ç®—</a><a href="å”®å¾Œæœå‹™è³‡æº-é›»è…¦ç‰ˆ/index.html.html" class="button-link">14. å”®å¾Œæœå‹™è³‡æº</a><a href="æˆ‘çš„çŸ¥è­˜ç®¡ç†/çŸ¥è­˜ç®¡ç†-ä¸»ç•«é¢.html" class="button-link">15. çŸ¥è­˜ç®¡ç†</a><a href="å®¢æˆ¶å»ºè­°æ›¸-å­˜æª”/å»ºè­°æ›¸å­˜æª”.html" class="button-link">16. å»ºè­°æ›¸å­˜æª”</a><a href="https://chungpinglee.github.io/abc0480//%E4%BF%9D%E9%9A%AA%E8%A6%8F%E5%8A%83%E5%95%8F%E5%8D%B7-%E5%AE%A2%E6%88%B6%E7%89%88.html" class="button-link">17. ä¿éšªè¦åŠƒå•å·</a><a href="https://www.youtube.com/results?search_query=%E4%BF%9D%E7%A0%94%E5%BF%AB%E4%BF%AE%E7%AB%99" class="button-link">18. ä¿ç ”å¿«ä¿®ç«™</a><a href="æ‰“æ“Šå¤ªç©ºèˆ¹.html" class="button-link">19. æ‰“æ“Šå¤ªç©ºèˆ¹</a></div>
    </div>

    <script>
        const buttonContainer = document.getElementById('buttonLinkContainer');
        const newButtonTextInput = document.getElementById('newButtonText');
        const newButtonUrlInput = document.getElementById('newButtonUrl');
        const newButtonPositionInput = document.getElementById('newButtonPosition');
        const removeButtonNumberInput = document.getElementById('removeButtonNumber');
        const newFileNameInput = document.getElementById('newFileNameInput');
        const saveAsButton = document.getElementById('handleSaveAsButton');
        const pageMainTitleH1 = document.getElementById('pageMainTitle');
        const toggleAdminButton = document.getElementById('toggleAdminButton');
        const adminSectionContent = document.getElementById('adminSectionContent');
        
        let currentLocalStorageKey = 'customMenuButtons_ä¸»è¦å…¥å£_1767107434167_v3'; 
        let currentAdminPanelVisibleKey = 'adminPanelVisible_ä¸»è¦å…¥å£_1767107434167_v3'; 

        const initialButtons = [
  {
    "text": "å®¢æˆ¶ç®¡ç†",
    "href": "å®¢æˆ¶ç®¡ç†.html"
  },
  {
    "text": "ä»²å¹³å—å±±äº‹æ¥­",
    "href": "https://share.evernote.com/note/c64a01a6-8956-430b-8cc8-88b6a364cd31"
  },
  {
    "text": "ä»²å¹³å…¨å®¶",
    "href": "https://share.evernote.com/note/aed884ef-c0fe-9b16-e927-98fd7661c7ff"
  },
  {
    "text": "é›»è…¦æ¡Œé¢ç®¡ç†",
    "href": "æä»²å¹³é›»è…¦æ¡Œé¢ç®¡ç†.html"
  },
  {
    "text": "115å¹´æœˆæ›†ç­†è¨˜æœ¬çµ±è¨ˆè¡¨",
    "href": "ç¨‹å¼-æœˆæ›†ç­†è¨˜æœ¬å•å·/æœˆæ›†ç­†è¨˜æœ¬å•å·-çµ±è¨ˆè¡¨.html"
  },
  {
    "text": "ä¿éšªè¦åŠƒæƒ³æ³•å•å·",
    "href": "ç¨‹å¼-å»ºè­°æ›¸è¦åŠƒå•å·åŠå›å‡½/ä¿éšªè¦åŠƒå‰å•å·-çµ±è¨ˆè¡¨.html"
  },
  {
    "text": "å—å±±äººå£½æ¥­å‹™.ç®¡ç†.è¡¨æ ¼",
    "href": "å—å±±äººå£½æ¥­å‹™æ¨å»£.ç®¡ç†.è¡¨æ ¼ä¸‹è¼‰.html"
  },
  {
    "text": "å—å±±ç”¢ç‰©æ¥­å‹™.ç®¡ç†.è¡¨æ ¼",
    "href": "å—å±±ç”¢ç‰©æ¥­å‹™æ¨å»£.ç®¡ç†.è¡¨å–®ä¸‹è¼‰.html"
  },
  {
    "text": "å—å±±å•†å“å°è¦½",
    "href": "ç¨‹å¼-å—å±±å•†å“å°è¦½/ä¿éšªå°è¦½ç³»çµ±_å®Œæ•´ç‰ˆ.html"
  },
  {
    "text": "å—å±±å•†å“å°è¦½-æ‰‹æ©Ÿç‰ˆ",
    "href": "https://chungpinglee.github.io/abc0480/%E4%BF%9D%E9%9A%AA%E5%B0%8E%E8%A6%BD%E7%B3%BB%E7%B5%B1_%E5%AE%8C%E6%95%B4%E7%89%88.html"
  },
  {
    "text": "TED35èˆ‡20TEDæ¯”è¼ƒ",
    "href": "https://chungpinglee.github.io/abc0480/TED35%E8%88%87TED%E6%AF%94%E8%BC%83.html"
  },
  {
    "text": "è»Šéšªå ±åƒ¹è¼”åŠ©èªªæ˜",
    "href": "https://chungpinglee.github.io/abc0480/1131122%E6%9D%8E%E4%BB%B2%E5%B9%B3%E8%BB%8A%E9%9A%AA%E5%85%A7%E5%AE%B9%E8%BC%94%E5%8A%A9%E8%AA%AA%E6%98%8E.html"
  },
  {
    "text": "æˆ¿åœ°åˆä¸€ç¨…è©¦ç®—",
    "href": "https://chungpinglee.github.io/abc0480/%E8%B2%A1%E7%A8%85%E9%80%9A-%E6%94%B9%E7%89%8844.html"
  },
  {
    "text": "å”®å¾Œæœå‹™è³‡æº",
    "href": "å”®å¾Œæœå‹™è³‡æº-é›»è…¦ç‰ˆ/index.html.html"
  },
  {
    "text": "çŸ¥è­˜ç®¡ç†",
    "href": "æˆ‘çš„çŸ¥è­˜ç®¡ç†/çŸ¥è­˜ç®¡ç†-ä¸»ç•«é¢.html"
  },
  {
    "text": "å»ºè­°æ›¸å­˜æª”",
    "href": "å®¢æˆ¶å»ºè­°æ›¸-å­˜æª”/å»ºè­°æ›¸å­˜æª”.html"
  },
  {
    "text": "ä¿éšªè¦åŠƒå•å·",
    "href": "https://chungpinglee.github.io/abc0480//%E4%BF%9D%E9%9A%AA%E8%A6%8F%E5%8A%83%E5%95%8F%E5%8D%B7-%E5%AE%A2%E6%88%B6%E7%89%88.html"
  },
  {
    "text": "ä¿ç ”å¿«ä¿®ç«™",
    "href": "https://www.youtube.com/results?search_query=%E4%BF%9D%E7%A0%94%E5%BF%AB%E4%BF%AE%E7%AB%99"
  },
  {
    "text": "æ‰“æ“Šå¤ªç©ºèˆ¹",
    "href": "æ‰“æ“Šå¤ªç©ºèˆ¹.html"
  }
];

        function escapeHtml(unsafe) {
            if (typeof unsafe !== 'string') return '';
            return unsafe.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }

        function saveButtonsToLocalStorage(buttonsToSave) {
            console.log(`Saving buttons with key: ${currentLocalStorageKey}`);
            localStorage.setItem(currentLocalStorageKey, JSON.stringify(buttonsToSave));
        }

        function loadButtonsFromLocalStorage() {
            console.log(`Loading buttons with key: ${currentLocalStorageKey}`);
            const savedButtons = localStorage.getItem(currentLocalStorageKey);
            if (savedButtons) {
                try {
                    const parsedButtons = JSON.parse(savedButtons);
                    return Array.isArray(parsedButtons) ? parsedButtons : JSON.parse(JSON.stringify(initialButtons));
                } catch (e) {
                    console.error("Error parsing stored button data, using initial:", e);
                    return JSON.parse(JSON.stringify(initialButtons));
                }
            }
            return JSON.parse(JSON.stringify(initialButtons));
        }

        function renderButtons() {
            const buttons = loadButtonsFromLocalStorage();
            buttonContainer.innerHTML = '';
            buttons.forEach((buttonData, index) => {
                const newButton = document.createElement('a');
                newButton.href = buttonData.href;
                newButton.className = 'button-link';
                newButton.textContent = `${index + 1}. ${escapeHtml(buttonData.text)}`;
                buttonContainer.appendChild(newButton);
            });
            newButtonPositionInput.max = buttons.length + 1;
            removeButtonNumberInput.max = buttons.length > 0 ? buttons.length : 1;
            removeButtonNumberInput.placeholder = buttons.length > 0 ? "è¦ç§»é™¤çš„æŒ‰éˆ•ç·¨è™Ÿ" : "æ²’æœ‰æŒ‰éˆ•å¯ç§»é™¤";
            if (buttons.length === 0) removeButtonNumberInput.value = '';
        }

        function handleAddNewButton() {
            const text = newButtonTextInput.value.trim();
            const url = newButtonUrlInput.value.trim();
            const posStr = newButtonPositionInput.value.trim();
            if (!text || !url) {
                alert("æŒ‰éˆ•æ–‡å­—å’Œç¶²å€ä¸èƒ½ç‚ºç©ºã€‚");
                return;
            }
            const currentButtons = loadButtonsFromLocalStorage();
            const newButtonData = { text, href: url };
            let position = posStr ? parseInt(posStr) : currentButtons.length + 1;
            position = Math.max(1, Math.min(position, currentButtons.length + 1));
            if (confirm(`ç¢ºèªæ–°å¢æŒ‰éˆ•?\næ–‡å­—: ${text}\nç¶²å€: ${url}\nä½ç½®: ${position}`)) {
                currentButtons.splice(position - 1, 0, newButtonData);
                saveButtonsToLocalStorage(currentButtons);
                renderButtons();
                newButtonTextInput.value = ''; newButtonUrlInput.value = ''; newButtonPositionInput.value = '';
                alert("æŒ‰éˆ•å·²æ–°å¢è‡³ç›®å‰é é¢è¨­å®šã€‚\nè‹¥è¦å°‡æ­¤è®Šæ›´ä¿å­˜ç‚ºæ–°æª”æ¡ˆæˆ–æ›´æ–°ç›®å‰æª”æ¡ˆï¼ˆé€éå¦å­˜ï¼‰ï¼Œè«‹ä½¿ç”¨ã€Œä¿®æ”¹æ¨™é¡Œä¸¦å¦å­˜ã€ã€‚");
            }
        }

        function handleRemoveButton() {
            const currentButtons = loadButtonsFromLocalStorage();
            if (currentButtons.length === 0) {
                alert("æ²’æœ‰æŒ‰éˆ•å¯ä»¥ç§»é™¤ã€‚");
                return;
            }
            const numStr = removeButtonNumberInput.value;
            if (!numStr) {
                alert("è«‹è¼¸å…¥è¦ç§»é™¤çš„æŒ‰éˆ•ç·¨è™Ÿã€‚");
                return;
            }
            const num = parseInt(numStr);
            if (isNaN(num) || num < 1 || num > currentButtons.length) {
                alert(`ç„¡æ•ˆçš„ç·¨è™Ÿã€‚è«‹è¼¸å…¥ 1 åˆ° ${currentButtons.length}ã€‚`);
                return;
            }
            if (confirm(`ç¢ºèªç§»é™¤æŒ‰éˆ• "${currentButtons[num - 1].text}"?`)) {
                currentButtons.splice(num - 1, 1);
                saveButtonsToLocalStorage(currentButtons);
                renderButtons();
                removeButtonNumberInput.value = '';
                alert("æŒ‰éˆ•å·²å¾ç›®å‰é é¢è¨­å®šä¸­ç§»é™¤ã€‚\nè‹¥è¦å°‡æ­¤è®Šæ›´ä¿å­˜ç‚ºæ–°æª”æ¡ˆæˆ–æ›´æ–°ç›®å‰æª”æ¡ˆï¼ˆé€éå¦å­˜ï¼‰ï¼Œè«‹ä½¿ç”¨ã€Œä¿®æ”¹æ¨™é¡Œä¸¦å¦å­˜ã€ã€‚");
            }
        }
        
        function savePageAs() {
            const newTitleFromInput = newFileNameInput.value.trim();
            const currentDocTitle = document.title; 
            const finalNewTitle = newTitleFromInput || currentDocTitle;
            let newFileName = finalNewTitle.replace(/\s+/g, '_').replace(/[\\/:*?"<>|#%&{}]/g, '') + '.html';
            if (newFileName.toLowerCase() === '.html' || (newFileName.startsWith('_') && newFileName.toLowerCase().endsWith('.html') && newFileName.length < 7)) {
                newFileName = `Untitled_Menu_${new Date().getTime()}.html`;
            }
            let htmlStringToSave = document.documentElement.outerHTML;
            const titleTagRegex = /(<title\b[^>]*>)([\s\S]*?)(<\/title>)/i;
            htmlStringToSave = htmlStringToSave.replace(titleTagRegex, `$1${escapeHtml(finalNewTitle)}$3`);
            if (pageMainTitleH1 && pageMainTitleH1.id) {
                const h1Regex = new RegExp(`(<h1\\b[^>]*id="${pageMainTitleH1.id}"[^>]*>)([\\s\S]*?)(<\\/h1>)`, "i");
                htmlStringToSave = htmlStringToSave.replace(h1Regex, `$1${escapeHtml(finalNewTitle)}$3`);
            }
            const buttonsToEmbed = loadButtonsFromLocalStorage(); 
            const buttonsStringForEmbedding = JSON.stringify(buttonsToEmbed, null, 2);
            const initialButtonsRegex = /const\s+initialButtons\s*=\s*(\[[\s\S]*?\])\s*;/i;
            if (htmlStringToSave.match(initialButtonsRegex)) {
                htmlStringToSave = htmlStringToSave.replace(initialButtonsRegex, `const initialButtons = ${buttonsStringForEmbedding};`);
            } else {
                console.warn("Could not find 'const initialButtons = ...;' in HTML string to update for new file.");
            }
            const isAdminHidden = adminSectionContent.classList.contains('hidden');
            const toggleBtnText = isAdminHidden ? 'â˜°' : 'âœ•';
            htmlStringToSave = htmlStringToSave.replace(
                /(<button\s+id="toggleAdminButton"[^>]*>)([\s\S]*?)(<\/button>)/i,
                `$1${toggleBtnText}$3`
            );
            const adminSectionClassRegex = /(<div\s+class="admin-section)([^"]*?)("\s+id="adminSectionContent"[^>]*>)/i;
            if (isAdminHidden) {
                if (!htmlStringToSave.match(/class="admin-section hidden"/i)) {
                     htmlStringToSave = htmlStringToSave.replace(adminSectionClassRegex, '$1 hidden$3');
                }
            } else {
                 htmlStringToSave = htmlStringToSave.replace(adminSectionClassRegex, (match, p1, p2, p3) => `${p1}${p2.replace(/\s*hidden\s*/g, '')}${p3}`);
            }
            let regeneratedButtonContainerHTML = '';
            buttonsToEmbed.forEach((buttonData, index) => {
                const buttonText = escapeHtml(`${index + 1}. ${buttonData.text}`);
                const buttonHref = buttonData.href;
                regeneratedButtonContainerHTML += `<a href="${buttonHref}" class="button-link">${buttonText}</a>`;
            });
            const buttonContainerRegex = /(<div\s+class="button-link-container"\s+id="buttonLinkContainer">)([\s\S]*?)(<\/div>)/i;
            if (htmlStringToSave.match(buttonContainerRegex)) {
                htmlStringToSave = htmlStringToSave.replace(buttonContainerRegex, `$1${regeneratedButtonContainerHTML}$3`);
            } else {
                 console.warn("Could not find buttonLinkContainer in HTML to update its static links for saving.");
            }
            const timestamp = new Date().getTime();
            const sanitizedTitleForNewKey = finalNewTitle.replace(/\s+/g, '_').replace(/[^\w\u4e00-\u9fa5-]/g, '');
            const newEmbeddedLocalStorageKey = `customMenuButtons_${sanitizedTitleForNewKey || 'file'}_${timestamp}_v3`;
            const newEmbeddedAdminPanelVisibleKey = `adminPanelVisible_${sanitizedTitleForNewKey || 'file'}_${timestamp}_v3`;
            console.log(`Embedding new keys into saved file: ${newEmbeddedLocalStorageKey}, ${newEmbeddedAdminPanelVisibleKey}`);
            const keyDefinitionRegex = (keyVarName) => 
                new RegExp(`(let\\s+${keyVarName}\\s*=\\s*['"])([^'"]+)(['"]\\s*;?)`, "i");
            htmlStringToSave = htmlStringToSave.replace(
                keyDefinitionRegex('currentLocalStorageKey'), 
                `$1${newEmbeddedLocalStorageKey}$3`
            );
            htmlStringToSave = htmlStringToSave.replace(
                keyDefinitionRegex('currentAdminPanelVisibleKey'), 
                `$1${newEmbeddedAdminPanelVisibleKey}$3`
            );
            const blob = new Blob([htmlStringToSave], { type: 'text/html;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = newFileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
            alert(`æª”æ¡ˆ "${newFileName}" å·²å¦å­˜ã€‚\næ­¤æ–°æª”æ¡ˆå°‡æ“æœ‰ç¨ç«‹çš„æŒ‰éˆ•è¨­å®šã€‚`);
        }

        function toggleAdminSectionVisibility() {
            const isHidden = adminSectionContent.classList.toggle('hidden');
            toggleAdminButton.textContent = isHidden ? 'â˜°' : 'âœ•';
            toggleAdminButton.title = isHidden ? 'é¡¯ç¤ºè¨­å®šå€å¡Š' : 'éš±è—è¨­å®šå€å¡Š';
            localStorage.setItem(currentAdminPanelVisibleKey, !isHidden); 
        }

        function loadAdminPanelState() {
            const isVisible = localStorage.getItem(currentAdminPanelVisibleKey); 
            if (isVisible === 'false') { 
                adminSectionContent.classList.add('hidden');
                toggleAdminButton.textContent = 'â˜°';
                toggleAdminButton.title = 'é¡¯ç¤ºè¨­å®šå€å¡Š';
            } else { 
                adminSectionContent.classList.remove('hidden');
                toggleAdminButton.textContent = 'âœ•';
                toggleAdminButton.title = 'éš±è—è¨­å®šå€å¡Š';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            newFileNameInput.value = document.title; 
            if (pageMainTitleH1) {
                pageMainTitleH1.textContent = document.title;
            }
            console.log(`Page loaded. Using LocalStorage Key: ${currentLocalStorageKey}, Admin Panel Key: ${currentAdminPanelVisibleKey}`);
            loadAdminPanelState();
            renderButtons();    
            if (saveAsButton) {
                saveAsButton.addEventListener('click', function() {
                    const targetTitle = newFileNameInput.value.trim() || document.title;
                    if (!confirm(`ç¢ºèªè¦å°‡ç›®å‰è¨­å®šå¦å­˜ç‚ºæª”æ¡ˆï¼Œæ¨™é¡Œç‚º "${targetTitle}" å—ï¼Ÿ\næ–°å„²å­˜çš„æª”æ¡ˆå°‡æœƒæ˜¯ç¨ç«‹çš„ã€‚`)) {
                        return;
                    }
                    savePageAs();
                });
            }
            if (toggleAdminButton) {
                toggleAdminButton.addEventListener('click', toggleAdminSectionVisibility);
            }

            // Racing cars speed randomization
            const greenCar = document.getElementById('greenCarContainer');
            const redCar = document.getElementById('redCarContainer');

            if (greenCar && redCar) {
                const baseDurationMin = 8;  // Minimum base duration in seconds
                const baseDurationMax = 13; // Maximum base duration in seconds
                const durationSpread = 2;   // Max difference between the two cars

                // Function to get a random duration within a range
                function getRandomDuration(min, max) {
                    return (Math.random() * (max - min) + min);
                }

                let greenDuration = getRandomDuration(baseDurationMin, baseDurationMax);
                let redDuration = getRandomDuration(baseDurationMin, baseDurationMax);

                // Ensure durations are different enough to avoid obvious ties
                // and make the "race" more noticeable
                while (Math.abs(redDuration - greenDuration) < 0.5) {
                    redDuration = getRandomDuration(baseDurationMin, baseDurationMax);
                }
                
                // For more pronounced "win/loss", ensure one is clearly faster for this load
                if (Math.random() < 0.5) { // 50% chance green is faster
                    greenDuration = Math.min(greenDuration, redDuration) - (Math.random() * durationSpread + 0.5) ;
                    redDuration = Math.max(greenDuration + 0.5 + Math.random(), redDuration); // ensure red is slower
                } else { // 50% chance red is faster
                    redDuration = Math.min(greenDuration, redDuration) - (Math.random() * durationSpread + 0.5);
                    greenDuration = Math.max(redDuration + 0.5 + Math.random() , greenDuration); // ensure green is slower
                }
                
                // Clamp durations to a reasonable min/max overall
                const overallMin = 7; // Absolute minimum speed
                const overallMax = 15; // Absolute maximum speed
                
                greenCar.style.animationDuration = `${Math.max(overallMin, Math.min(overallMax, greenDuration)).toFixed(2)}s`;
                redCar.style.animationDuration = `${Math.max(overallMin, Math.min(overallMax, redDuration)).toFixed(2)}s`;

                // console.log(`Green Car Speed: ${greenCar.style.animationDuration}, Red Car Speed: ${redCar.style.animationDuration}`);
            }
        });
    </script>

</body></html>